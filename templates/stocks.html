<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stock Watchlist</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">

  <div class="max-w-6xl mx-auto py-10 px-4">
    <h1 class="text-3xl font-bold mb-6 text-center">📈 Watch List</h1>

    <!-- 新增股票 -->
    <form action="/add_stock" method="post" class="flex justify-center mb-6">
      <input name="symbol" placeholder="輸入股票代碼 (e.g. AAPL)" 
             class="px-4 py-2 border border-gray-300 rounded-l-md w-2/3 focus:outline-none focus:ring-2 focus:ring-blue-400">
      <button type="submit" 
              class="bg-blue-500 text-white px-4 py-2 rounded-r-md hover:bg-blue-600">新增</button>
    </form>

    <!-- 表格 -->
    <div class="overflow-x-auto bg-white rounded-lg shadow-md">
      <table class="min-w-full table-auto">
        <thead class="bg-gray-200 text-gray-700 text-left text-sm uppercase">
          <tr>
            <th class="px-4 py-3">股票代碼</th>
            <th class="px-4 py-3">即時股價</th>
            <th class="px-4 py-3">漲跌幅</th>
            <th class="px-4 py-3">加碼價</th>
            <th class="px-4 py-3">距現價%</th>
            <th class="px-4 py-3">更新加碼價</th>
            <th class="px-4 py-3">刪除</th>
            <th class="px-4 py-3">通知測試</th>
          </tr>
        </thead>
        <tbody class="text-gray-700">
          {% for stock in stocks %}
          <tr class="border-b">
            <td class="px-4 py-3 font-semibold">{{ stock.symbol }}</td>
            <td class="px-4 py-3">${{ stock.price }}</td>
            <td class="px-4 py-3">
              {% if stock.change_percent is not none %}
                {% if stock.change_percent > 0 %}
                  <span class="text-green-600 font-semibold">+{{ stock.change_percent }}%</span>
                {% elif stock.change_percent < 0 %}
                  <span class="text-red-600 font-semibold">{{ stock.change_percent }}%</span>
                {% else %}
                  <span class="text-gray-600">{{ stock.change_percent }}%</span>
                {% endif %}
              {% else %}
                <span class="text-gray-500">N/A</span>
              {% endif %}
            </td>
            <td class="px-4 py-3 text-blue-600 font-medium">
              ${{ stock.add_price }}
            </td>
            <td class="px-4 py-3">
              {% if stock.gap_percent is not none %}
                {% if stock.gap_percent > 0 %}
                  <span class="text-red-600">高 {{ stock.gap_percent }}%</span>
                {% elif stock.gap_percent < 0 %}
                  <span class="text-green-600">低 {{ -stock.gap_percent }}%</span>
                {% else %}
                  <span class="text-gray-500">0%</span>
                {% endif %}
              {% else %}
                <span class="text-gray-500">N/A</span>
              {% endif %}
            </td>
            <td class="px-4 py-3">
              <form action="/set_add_price" method="post" class="flex gap-2">
                <input type="hidden" name="symbol" value="{{ stock.symbol }}">
                <input type="number" step="0.01" min="0" name="add_price" 
                       class="border border-gray-300 px-2 py-1 rounded w-24 text-sm focus:ring-1 focus:ring-blue-300">
                <button type="submit" 
                        class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600">
                  設定
                </button>
              </form>
            </td>
            <td class="px-4 py-3">
              <form action="/delete_stock" method="post">
                <input type="hidden" name="symbol" value="{{ stock.symbol }}">
                <button type="submit" 
                        class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">
                  刪除
                </button>
              </form>
            </td>
            <td class="px-4 py-3">
              <form action="/notify" method="post">
                <input type="hidden" name="symbol" value="{{ stock.symbol }}">
                <button type="submit"
                        class="bg-purple-500 text-white px-3 py-1 rounded text-sm hover:bg-purple-600">
                  發送
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</body>
</html>
