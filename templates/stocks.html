<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Stock Watchlist</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 text-gray-900">
    <div class="max-w-6xl mx-auto py-10 px-4">
      <h1 class="text-3xl font-bold mb-6 text-center">ğŸ“ˆ Watch List</h1>

      <!-- ğŸ”” è¨Šæ¯æç¤º -->
      {% if request.query_params.get("msg") == "exist" %}
      <div
        class="p-4 mb-6 rounded border bg-yellow-100 border-yellow-500 text-yellow-700"
      >
        âš ï¸ è‚¡ç¥¨
        <strong>{{ request.query_params.get("symbol") }}</strong>
        å·²åœ¨è§€å¯Ÿæ¸…å–®ä¸­ã€‚
      </div>
      {% elif request.query_params.get("msg") == "added" %}
      <div
        class="p-4 mb-6 rounded border bg-green-100 border-green-500 text-green-700"
      >
        âœ… æˆåŠŸæ–°å¢
        <strong>{{ request.query_params.get("symbol") }}</strong>ï¼Œç¾åƒ¹ ${{
        request.query_params.get("price") }}
      </div>
      {% elif request.query_params.get("msg") == "price_set" %}
      <div
        class="p-4 mb-6 rounded border bg-blue-100 border-blue-500 text-blue-700"
      >
        ğŸ’¾ åŠ ç¢¼åƒ¹å·²è¨­å®šï¼š<strong
          >{{ request.query_params.get("symbol") }}</strong
        >
        â†’ ${{ request.query_params.get("price") }}
      </div>
      {% elif request.query_params.get("msg") == "deleted" %}
      <div
        class="p-4 mb-6 rounded border bg-gray-100 border-gray-400 text-gray-700"
      >
        ğŸ—‘ï¸ å·²åˆªé™¤ <strong>{{ request.query_params.get("symbol") }}</strong>ã€‚
      </div>
      {% elif request.query_params.get("msg") == "error" %}
      <div
        class="p-4 mb-6 rounded border bg-red-100 border-red-500 text-red-700"
      >
        âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š{{ request.query_params.get("error") or "æœªçŸ¥éŒ¯èª¤" }}
      </div>
      {% endif %}

      <!-- æ–°å¢è‚¡ç¥¨ -->
      <form action="/add_stock" method="post" class="flex justify-center mb-6">
        <input
          name="symbol"
          placeholder="è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼ (e.g. AAPL)"
          class="px-4 py-2 border border-gray-300 rounded-l-md w-2/3 focus:outline-none focus:ring-2 focus:ring-blue-400"
        />
        <button
          type="submit"
          class="bg-blue-500 text-white px-4 py-2 rounded-r-md hover:bg-blue-600"
        >
          æ–°å¢
        </button>
      </form>

      <!-- è¡¨æ ¼ï¼ˆä¿æŒä½ åŸæœ¬çš„ç¨‹å¼ç¢¼ï¼‰ -->
      <div class="overflow-x-auto bg-white rounded-lg shadow-md">
        <table class="min-w-full table-auto">
          <thead class="bg-gray-200 text-gray-700 text-left text-sm uppercase">
            <tr>
              <th class="px-4 py-3">è‚¡ç¥¨ä»£ç¢¼</th>
              <th class="px-4 py-3">å³æ™‚è‚¡åƒ¹</th>
              <th class="px-4 py-3">æ¼²è·Œå¹…</th>
              <th class="px-4 py-3">åŠ ç¢¼åƒ¹</th>
              <th class="px-4 py-3">è·ç¾åƒ¹%</th>
              <th class="px-4 py-3">æ›´æ–°åŠ ç¢¼åƒ¹</th>
              <th class="px-4 py-3">åˆªé™¤</th>
              <th class="px-4 py-3">é€šçŸ¥æ¸¬è©¦</th>
            </tr>
          </thead>
          <tbody class="text-gray-700">
            {% for stock in stocks %}
            <tr class="border-b">
              <td class="px-4 py-3 font-semibold">{{ stock.symbol }}</td>
              <td class="px-4 py-3">${{ stock.price }}</td>
              <td class="px-4 py-3">
                {% if stock.change_percent is not none %} {% if
                stock.change_percent > 0 %}
                <span class="text-green-600 font-semibold"
                  >+{{ stock.change_percent }}%</span
                >
                {% elif stock.change_percent < 0 %}
                <span class="text-red-600 font-semibold"
                  >{{ stock.change_percent }}%</span
                >
                {% else %}
                <span class="text-gray-600">{{ stock.change_percent }}%</span>
                {% endif %} {% else %}
                <span class="text-gray-500">N/A</span>
                {% endif %}
              </td>
              <td class="px-4 py-3 text-blue-600 font-medium">
                ${{ stock.add_price }}
              </td>
              <td class="px-4 py-3">
                {% if stock.gap_percent is not none %} {% if stock.gap_percent >
                0 %}
                <span class="text-red-600">é«˜ {{ stock.gap_percent }}%</span>
                {% elif stock.gap_percent < 0 %}
                <span class="text-green-600">ä½ {{ -stock.gap_percent }}%</span>
                {% else %}
                <span class="text-gray-500">0%</span>
                {% endif %} {% else %}
                <span class="text-gray-500">N/A</span>
                {% endif %}
              </td>
              <td class="px-4 py-3">
                <form action="/set_add_price" method="post" class="flex gap-2">
                  <input
                    type="hidden"
                    name="symbol"
                    value="{{ stock.symbol }}"
                  />
                  <input
                    type="number"
                    step="0.01"
                    min="0"
                    name="add_price"
                    class="border border-gray-300 px-2 py-1 rounded w-24 text-sm focus:ring-1 focus:ring-blue-300"
                  />
                  <button
                    type="submit"
                    class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600"
                  >
                    è¨­å®š
                  </button>
                </form>
              </td>
              <td class="px-4 py-3">
                <form action="/delete_stock" method="post">
                  <input
                    type="hidden"
                    name="symbol"
                    value="{{ stock.symbol }}"
                  />
                  <button
                    type="submit"
                    class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600"
                  >
                    åˆªé™¤
                  </button>
                </form>
              </td>
              <td class="px-4 py-3">
                <form action="/notify" method="post">
                  <input
                    type="hidden"
                    name="symbol"
                    value="{{ stock.symbol }}"
                  />
                  <button
                    type="submit"
                    class="bg-purple-500 text-white px-3 py-1 rounded text-sm hover:bg-purple-600"
                  >
                    ç™¼é€
                  </button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </body>
</html>
